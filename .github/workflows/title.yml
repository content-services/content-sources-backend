name: PR Validation 
on:
  pull_request:
    types: [opened, edited, reopened]

jobs:
  rename-konflux-pr:
    name: Rename Konflux PR Title
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Add "Build:" to PR title
        if: github.event.pull_request.user.login == 'red-hat-konflux' && !startsWith(github.event.pull_request.title, 'Build:')
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          PR_NUMBER: ${{ github.event.pull_request.number }}
          PR_TITLE: ${{ github.event.pull_request.title }}
        run: |
          gh pr edit $PR_NUMBER --title "Build: $PR_TITLE"
  
  title-validate:
    name: Title
    runs-on: ubuntu-latest
    steps:
    - uses: deepakputhraya/action-pr-title@master
      with:
        regex: '^Build|Test|^(\w+-\d+(,\w+-\d+)*): .+' # Regex the title should match.
        disallowed_prefixes: '' # title should not start with the given prefix
        prefix_case_sensitive: false # title prefix are case insensitive
        min_length: 5 # Min length of the title
        max_length: 70 # Max length of the title
        github_token: ${{ github.token }} # Default: ${{ github.token }}
